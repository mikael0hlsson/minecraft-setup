version: '3.4'

services:
  backup:
    image: kaiede/minecraft-bedrock-backup
    restart: always
    depends_on:
      - bedrock_axel
    environment:
      BACKUP_INTERVAL: "3h"
      TZ: "Europe/Stockholm"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./backups:/backups
      - ./axel_data:/bedrock_axel
    command: ["/bin/sh","-c","sleep 10; exec /entrypoint.sh"]
    healthcheck:
      test: ["CMD-SHELL", "exit 0"]   # always healthy
      interval: 1m
      timeout: 5s
      retries: 1
      start_period: 10s

  bedrock_axel:
    image: itzg/minecraft-bedrock-server
    container_name: bedrock_axel
    restart: always
    environment:
      TZ: "Europe/Stockholm"
      SERVER_NAME: "Den bästa servern någonsin"
      EULA: "TRUE"
      GAMEMODE: survival
      DIFFICULTY: hard
      LEVEL_SEED: Axel
      LEVEL_NAME: Axel
      ONLINE_MODE: "true"
      VIEW_DISTANCE: 32
      TICK_DISTANCE: 12
      PLAYER_IDLE_TIMEOUT: 0
    ports:
      - "19132:19132/udp"
    volumes:
      - "./axel_data:/data"
    stdin_open: true
    tty: true
    healthcheck:
      test: ["CMD", "mc-monitor", "status-bedrock", "--host", "0.0.0.0", "--port", "19132", "-retry-limit", "5", "-retry-interval", "10s"]
      interval: 30s
      timeout: 5s
      retries: 6
      start_period: 60s

  pro_server:
    image: itzg/minecraft-bedrock-server
    container_name: bedrock_pro_server
    restart: always
    environment:
      TZ: "Europe/Stockholm"
      SERVER_NAME: "Den näst bästa servern någonsin"
      EULA: "TRUE"
      GAMEMODE: survival
      DIFFICULTY: hard
      LEVEL_SEED: pro_server
      LEVEL_NAME: pro_server
      ONLINE_MODE: "true"
      VIEW_DISTANCE: 32
      TICK_DISTANCE: 12
      PLAYER_IDLE_TIMEOUT: 0
    ports:
      - "19142:19132/udp"
    volumes:
      - "./pro_server:/data"
    stdin_open: true
    tty: true
    healthcheck:
      test: ["CMD", "mc-monitor", "status-bedrock", "--host", "0.0.0.0", "--port", "19132", "-retry-limit", "5", "-retry-interval", "10s"]
      interval: 30s
      timeout: 5s
      retries: 6
      start_period: 60s

  # --- Web GUI for your containers (keeps your backup + servers exactly as-is) ---
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: unless-stopped
    ports:
      - "9000:9000"            # HTTP on host:9000 → container:9000
    command: ["--http-enabled"]# turn on the HTTP listener
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data   # persists Portainer settings


volumes:
  portainer_data:
